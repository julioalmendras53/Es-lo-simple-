<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Libro + Diccionario</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1rem;
      display: flex;
      gap: 1.5rem;
    }

    #contenedor {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
      width: 100%;
    }

    #libro {
      line-height: 1.6;
      text-align: justify;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 8px;
      max-height: 80vh;
      overflow-y: auto;
    }

    #definicion {
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 8px;
      max-height: 80vh;
      overflow-y: auto;
    }

    .palabra { cursor: pointer; }
    .palabra:hover { text-decoration: underline; }

    .palabra.resaltada {
      color: blue;
      font-weight: bold;
    }

    h1 { grid-column: 1 / -1; margin-top: 0; }

    .sin-def {
      color: #999;
      font-style: italic;
    }
  </style>
</head>

<body>
<div id="contenedor">

  <h1>Libro del Infinito</h1>

  <!-- TEXTO DEL LIBRO -->
  <pre id="texto-libro" style="display:none;">

 1 es aterrador 16857 El infinito ha dado un plus a la materia. 16858 El infinito es aterrador como el 1. 16859 No se anda con simplezas √©ste 1. 16860 Si acumularamos los teoremas que tienen por fundamento en el 1, estar√≠amos hasta los 80 a√±os hablando,  sin vejez ya. 16861 El infinito quiere alzarse con el trofeo del 1. 16862 Sin un contexto, el 1, tiene poco que decir. 16863 El infinito pertenece a un conjunto hiperreal. 16864 Si contamos las veces que infinito ha dado algo a este servidor, no bastar√≠a para comenzar. 16865 El infinito tiene a 1 como un posible resultado de m√∫ltiples casos. 16866 Para mostrar un bot√≥n. 16867 La ra√≠z infinita de infinito es tendente al 1. 16868 ¬øQui√©n sac√≥ este naipe del codo? 16869 Parece que las operaciones para llegar a ese resultado no son complejas. 16870 Sin complejidad, cero tiene a√∫n m√°s sentido. 16871 El infinito se desglos√≥ en infinito e infinita para llegar a 1. 16872 El infinito es en un desglose 1 s√≥lo sin m√°s a√±adidos. 
    16873 Parece que a√±adir indefinidamente buscase un fin. 16874 Parece que a√±adir 1 al 1 no montara mucho a ojos del infinito. 
    16875 Cuando se llega a esos entornos tan brutales, no tiene caso el 1. 16876 El infinito es 1 y el primero. 16877 Ya esboc√© que el 1 es aterrador y partir mi escrito m√°ximo, debe justificar sus decisiones. 16878 Por eso es que en el juego del go, Alfago, demor√≥ de 30 a 40 segundos en responder a la piedra primera acotada por Lee Sedol. 16878 bis La inteligencia dice que para asegurar el fuseki es necesario casi demorar una jugada, que es la m√°s importante.  16879 Que pasara un minuto, tambi√©n podr√≠a ser. 16880 El 1 es tan aterrador, porque no hay destino en la tierra m√°s todav√≠a. 16881 El infinito es vertebrador de los d√≠gitos nombrados. 16882 El infinito es siempre algo que no tiene fin. 16883 Toda la definici√≥n de infinito puede ser puesta en lenguaje matem√°tico. 16884 No hay nada que la matem√°tica y sus matem√°ticos desconozcan del infinito, a√∫n as√≠ insisten en que no tiene sentido, esas operaciones que no gustan. 
    16885 Sin el 1, no habr√≠a origen. 16886 Es primero el 1 entre 0, el que pone la pol√©mica en la mesa. 16887 Es m√°s todav√≠a, el 1 es origen de todo n√∫mero, incluyendo el infinito, s√≠ lo creo. 16888 El infinito sigue siendo la v√©rtebra en este universo m√°ximo. 16889 Conseguir el 1 debiera ser el principal objetivo del infinito, pero descreo de ello pronto. 16890 En un plano complejo el 1 es m√°s especial, porque se le a√±aden cosas, sin dejar de ser 1. 16891 El infinito es matem√°ticamente perfecto, ya que de matem√°ticamente puede ser, ya que, por bis, infinito no es existente sin la matem√°tica, y lo de perfecto es claro que el matem√°tico, puede pasar a su dialecto toda la definici√≥n, con alguna reticencia. 16892 El infinito me exige a buscar en 1, algo m√°s all√° del n√∫mero meramente. 16893 Muy obtuso ser√© si llego con que el 1 no es real, en el caso de que cero es denominador. 16894 Algo de verdad tendr√° que cero no puede dividir a ning√∫n/alg√∫n n√∫mero. 16895 O quiz√° est√© hablando el miedo del matem√°tico, con decir que no se puede. 16896 Yo prefiero creer en el miedo, que es m√°s l√≥gico ante algo extra√±o. 16897 El 1 es origen de Google, as√≠ como es origen del n√∫mero de Graham. 16898 Yo no quiero creer eso. 16899 Graham ha desquiciado el 1 con apartarse del sistema num√©rico decimal. 16900 En infinito 1 es el origen debido. 16901 Pero 1 tiene un poder en multiplicarse con n√∫meros alteraandolos m√≠nimamente. 16902 El infinito es una ecuaci√≥n. 16903 Nada en la matem√°tica es cero. 16904 La nada aqu√≠ no est√°. 16905 Si nos vamos a referir a cero, declararemos que es algo por convenci√≥n. 16906 De sumar 1 a 1 result√≥ la ‚àö2. 16907 ¬øC√≥mo es eso? 16907 Muy pocos recursos se hizo Hipaso de Metaponto, al sumar, simple, a 1 con 1. 16908 El infinito tiene un listado de n√∫meros que siguen la ley del infinito. Esto es √±a√±.16909 El infinito tiene a ‚àö2 como su primer elemento. 16910 De ah√≠ saltamos a los n√∫meros primos bajo ra√≠z. 16911 Todo n√∫mero primo bajo ra√≠z, deber√° ser irracional. 16912 Tratar de aplicar raz√≥n a los n√∫meros primos, quiz√° est√© errado. 16913 El infinito es un n√∫mero, creo. 16914 El infinito es aterrador, misma cosa pasa con el 1. 16915 Parece que a la usanza de infinito, sumar 1 es algo rid√≠culamente especial. 16916 (1 +1) y bajo ra√≠z se sale de raz√≥n. 16917 El 1 no es aterrador, porque es nuestro aliado. 16918 Perder la raz√≥n no es algo especial. 16919 M√°s bien ser raz√≥n es lo especial. 16920 Leer√© este escrito una y otra vez, porque quiero que tenga una coherencia de 666. 16921 Con que la Iglesias referencie a 666 como el n√∫mero bestial bastar√°. 16922 El infinito es un resumen de la existencia. 16923 Partimos con los n√∫meros de contar. 16924 Me miro la mano con 5 dedos y me pregunto, ¬øhabr√° una correspondencia en la naturaleza? 16925 El infinito se hace desde un 1. 16926 Los matem√°ticos nos dicen que el universo se hizo del vac√≠o. 16927 Yo me opongo fuertemente a ello. 16928 Antes de la palabra divina, hab√≠a un ser planeando en el aire del horizonte. 16929 Como abarcando todo. 16930 Quiz√° fue el infinito transmutado en una tierra preexistente. 16931 Un ser era el que planeaba. 16932 Es com√∫n esa idea de que los seres podr√≠an llegar a volar, por alguna potencia salida de s√≠ mismos. 16933 ¬øQu√© intenci√≥n ten√≠a Dios en planear 1 en la tierra preexistente? 16934 Dios fue singular en ese momento, y sigui√≥ siendo singular todo el tiempo, hasta el futuro m√≠o. 16935 Al menos lleguemos a la frase 17 mil antes de pasar al aterrador 2. 16936 El infinito es un elemento elemental. 16937 Nada avanzar√© con eso. 16938 Sin 1, no tendr√≠amos el altisonante universo. 16939 En el cosmos nada hay de unidad, y ello es extra√±o, ya que 1 est√° en todo n√∫mero. 16940 Para empezar el 1 y el n√∫mero son los divisores de los n√∫meros primos, excluyendo todo otro for√°neo como un n√∫mero compuesto. 16941 El infinito prefiri√≥ negar, antes que decir que su infinito era de 1. 16942 Pudo decir que 1 era su fin, sin embargo, los datos no revelan eso. 16943 Tanto es la definici√≥n del infinito que llega al n√∫mero 3 y 2. 16944 Tres negaciones. 16945 El infinito no tiene 3 fines, sino dos. 16946 Este menosprecio del 1 es caracter√≠stico del car√°cter de no unificar las cosas primero. 16947 El 1 es aterrador, porque no hay algo bajo el sol que guarde m√°s secretos que el triste n√∫mero 1. 16948 Su secretismo es pavoroso. 16949 No hay otro objetivo que hacerte ver que infinito es un n√∫mero real. 16950 Y que lo irreal es el 1. 16951 Sin 1, no tendr√≠amos a 2 ni ‚àö2 . 16952 Sumar 1 entre n√∫meros del 0 al 10, tiene un recorrido asombrosamente grande. 16953 El 1 tiene algo de grandeza en permitir a los humanos buscar unidad. 16954 El infinito es gestor del 1. 16955 Casi que el primero fuera por infinito. 16956 El infinito es un ser que continuamente est√° amando. 16957 El genio de este escrito es presentar argumentos de la numeridad del infinito y nada m√°s. 16958 El infinito es aterrador como lo es el 1. 16959 Yo sospecho m√°s en 1 que en cero, como la otra cara de la moneda, principiada por infinito. 16960 No hay en cero lo que hay en 1. 16961 Sin unidad, no tiene sentido hablar del
  </pre>

  <div id="libro"></div>

  <div id="definicion">
    <h2>Definici√≥n</h2>
    <p>Haz clic en una palabra del libro para ver su definici√≥n.</p>
  </div>

</div>
</div>  <!-- cierre del contenedor -->



<div id="resumen" style="margin-top:20px;"></div>

<script>
    
/* -------------------------------------
   FUNCIONES DE NORMALIZACI√ìN
------------------------------------- */
function normalizarPalabra(raw = "") {
  return raw
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9√±]/gi, "");
}

/* -------------------------------------
   DICCIONARIO COMPLETO (FUNCIONAL)
------------------------------------- */
const diccionario = {
  infinito:   { definicion: "Que crece sin parar.", imagen: "images/infinito.jpg" },
      perro:      { definicion: "Mam√≠fero dom√©stico carn√≠voro y canido del que hay cerca de 350 razas distintas variando en forma, tama√±o y pelaje. Tiene o√≠do y olfato muy agudos y es leal a su due√±o.", imagen: "images/perro.jpg"},
      
      
      ser:        { definicion: "Para afirmar o negar un puente entre sujeto y predicado." },
      monstruo:   { definicion: "Animal fabulado, extraordinario, de figura horrible." , imagen: "images/monstruo.jpg" },
      "tirabuz√≥n":{ definicion: "Cada una de las espirales que forma un cabello enrollado naturalmente." },
      ropa:       { definicion: "Conjunto de prendas que sirven para cubrir el cuerpo humano." , imagen: "images/ropa.png" }, 
      ilimitado:  { definicion: "Que no posee l√≠mite." },
      universo:   { definicion: "Todo lo que existe tanto fuera de la Tierra como dentro." , imagen: "images/universo.png"  }, 
      dios:       { definicion: "Ser supremo que puede todo lo coherente y que se le rinde culto en buena parte del mundo." , imagen: "images/dios.png" }, 
      cristo:     { definicion: "Hijo de Dios." , imagen: "images/cristo.png" }, 
      madre:      { definiciones: [
                     "Mujer especial que ha engendrado uno o m√°s hijos y que es s√≠mbolo de protecci√≥n.",
                     "T√©rmino coloquialmente abreviado como mam√°."
                   ], cita: "¬´Madre: la palabra m√°s bella pronunciada por el ser humano¬ª ‚Äî Kahlil Gibran" , imagen: "images/madre.png" }, 
  librero:    { definiciones: [
                    "Individuo que comercia con libros.",
                    "Estante donde se colocan los libros." ] },
      bbc:        { definicion: "Tr√≠o de delanteros hist√≥rico del Real Madrid compuesto por benzema, bale y Cristiano." , imagen: "images/bbc.jpeg" },
      msn:        { definicion: "Tr√≠o de delanteros hist√≥rico del Barcelona compuesto por Messi, Su√°rez y Neymar." , imagen: "images/msn.jpeg" },
      google:     { definicion: "Empresa multinacional tecnol√≥gica que orden√≥ con algoritmos potentes internet." },
      infinitamente: { definiciones: [ 
                             "De modo infinito.",
                             "De manera infinita.",
                             "De forma infinita." ] },
      idempotente: { definicion: "Igualdad en la capacidad de un n√∫mero de multiplicarse por √©l y no transmutarse." , imagen: "images/idempotente.png" },
      partivo:    { definicion:  "Idea que surge de ver la separaci√≥n entre 2 ques." },
      adjetivo:   { definicion:  "Palabra que se pone antes o despu√©s de un sustantivo y que concuerda con √©l en g√©nero y n√∫mero sirviendo para caracterizar al sustantivo." },
      regicida:   { definiciones:  [
                             "Que intenta o consuma la muerte de un rey.",
                             "Que come el rey en ajedrez, terminando el juego."  ] },
      ajedrez:    { definicion: "Juego mental entre dos oponentes en un tablero 8√ó8 escaques con 16 piezas con distinto poder que consiste en dejar sin opci√≥n a un rey por √∫ltimo." , video: "videos/ajedrez.webm" },
      "informaci√≥n":{definiciones: [
                              "Conversi√≥n desde el dato simple hacia un conjunto que reduce la incertidumbre de algo.",
                              "Acci√≥n y efecto de informar.",
                              "En gen√©tica: conjunto de datos que sirven para que a la c√©lula tenga todo claro." ] , imagen: "images/informaci√≥n.png" },
      dato:       { definicion: "Estadio previo a una informaci√≥n hecha que es meramente una idea suelta sin gobierno y que unida a otras puede ser analizada." },
      bidefinido: { definicion: "Definido con 2 frases solas." },
      tridefinido:{ definicion: "M√°xima cantidad de frases que pueden esbozarse para definir." },
      escritor:   { definicion: "Persona que ha escrito una obra literaria asentada." },
      escribidor: { definicion: "Persona que escribe sin talento o que lo hace sin inspiraci√≥n." },
      loco:       { definicion: "Que se ha vuelto irracional o sea que ha extraviado la raz√≥n." },
      misericordia: { definicion: "Virtud de Dios o el hombre de sentir compasi√≥n en el coraz√≥n por las pobrezas de alguien." },
      dibu:       { definicion: "Portero argentino en especial atajador de penales." },
      deporte:    { definicion: "Actividad f√≠sica o mental reglada que se usa como competencia y que siempre tiene tanteo." },
      nostalgia:  { definicion: "Tristeza por encontrarse en ausencia del amor." },
      conjetura:  { definicion: "Idea que a partir de datos lanza una suposici√≥n que de ser cierta se nombraria como teorema." },
      "matem√°tica":{ definicion: "√Årea del saber que generaliza los n√∫meros y las operaciones con vastas aplicaciones." },
      "matem√°tico":{ definicion: "Aquella persona que estudia la matem√°tica y hace de ello su arte." },
      dibujar:    { definicion: "Trazar l√≠neas y rellenando el espacio alrededor con color a base de pinceles o bol√≠grafo obtener una figura." },
      dibujo:     { definicion: "Confecci√≥n art√≠stica que tiene forma y color." },
      laberinto:  { definicion: "Lugar f√≠sico o conceptual artificialmente creado con caminos absurdos y que dificultan tanto orientarse como encontrar salida." },
      flaco:      { definicion: "Calificativo que habla de la poca masa grasa o poca masa muscular de un individuo situandose en un IMC bajo 18,5 resulta en tener poco vigor o fuerza para lidiar o en actividades diarias." },
      el:         { definicion: "Art√≠culo que indica un nombre consabido de n√∫mero singular y g√©nero masculino." },
      √±ato:       { definicion: "De narices peque√±as en prominencia." },
      "narig√≥n":{ definicion: "De narices abultadas." },
      demonio:    { definicion: "Ser sobrenatural malvado que es el pr√≠ncipe de los √°ngeles ca√≠dos que se rebel√≥ ante Dios y fue destinado al tartaro." },
      "car√≥n":{ definiciones: [ 
                               "Se dice de la persona con cara prominente no tan usada como carota.",
                               "Levemente borracho."  ] },
      infierno:   { definicion: "Lugar de tormentos eternos para las almas que han pecado." , imagen: "images/infierno.png" },
      cono:       { definicion: "S√≥lido de revoluci√≥n que es generado por la rotaci√≥n de un cateto de un tri√°ngulo formando una base circular y en el extremo opuesto un v√©rtice." },
      existir:    { definicion: "Ser real y enteramente cre√≠ble." },
      tenedor:    { definicion: "√ötil de mesa formado de un mango con m√°s de 3 p√∫as al otro extremo con lo cual se pinchan o sostienen alimentos s√≥lidos." },
      cuchara:    { definicion: "√ötil de mesa con mango y en el extremo una concavidad de metal propia para consumir alimentos l√≠quidos mayoritariamente." },
      cuchillo:   { definicion: "√ötil de mesa con un filo por una banda para cortar en trozos alimentos s√≥lidos." },
      indeterminado: {definicion: "No determinado a un resultado √∫nico sino que tiene infinitas medidas." },
      indefinido: { definicion: "No definido." },
      "pal√≠ndromo":{ definicion: "Frase que se lee levogira igual que dextrogira." },
      capicua:    { definicion: "N√∫mero que se lee igual de inicio a fin que de fin a inicio." },
      morfema:    { definicion: "Unidad minuscula de significado de una palabra como in- de infinito que significa no o sin. " },
      virus:{ definiciones: [ 
                            "Germen infeccioso que entra a la c√©lula humana usando su maquinaria gen√©tica para formar partes de su ser y que suele escaparse causando destrucci√≥n de la c√©lula hu√©sped, consta de un adn o arn con una cubierta prote√≠na y as√≠ simple enferma al humano. ",
                            "Mecanismo infeccioso inform√°tico que se instala en entornos digitales y da√±a la maquinaria que hace funcionar al computador." ] },
      androide:   { definicion: "Autom√°ta a manera de humano." },
      robot:      { definicion: "Autom√°ta sin necesidad de parecerse al humano y que aprende por s√≠." },
      maquina:    { definicion: "Objeto que es animado a la efectividad, que se mueve y que realiza trabajo." },
      ultrainstinto: { definicion: "Tecnica divina que permite pelear sin pensar y por tanto, escapar de cualquier peligro. La us√≥ goku en el torneo contra jiren.", imagen: "images/ultrainstinto.jpg" },
      jiren:      { definicion: "Mortal m√°s fuerte que Su Dios de la destrucci√≥n en el universo 11 de dragon ball super." , imagen: "images/jiren.jpg" }, 
      nada:       { definicion: "aquello que es pensable solo por negaci√≥n y no es realizable." , imagen: "images/nada.jpg" },
      gato:       { definicion: "Mam√≠fero carn√≠voro dom√©stico de la familia F√©lidos (Felis catus), de cuerpo √°gil, garras retr√°ctiles y sentidos muy desarrollados (visi√≥n crepuscular, o√≠do fino, gran equilibrio). Es territorial y cazador de peque√±os animales; se comunica con maullidos, bufidos y ronroneo." , imagen: "images/gato.png" },
      precomputada:{ definicion: "Calculada con anterioridad y lista para ser usado o recuperado." , imagen: "images/precomputada.png" },
      holomorfa:   { definicion: "Funci√≥n que es diferenciable y suave en cada punto." , imagen: "images/holomorfa.png" },
      meromorfa:   { definicion: "Funci√≥n que es diferenciable y suave en todo punto excepto en uno de polo que diverge hacia infinito." , imagen: "images/meromorfa.png" }, 
      jirafa:      { definicion: "Mam√≠fero artiodactilo rumiante que es el animal m√°s alto del mundo con su cuello de 2,4 metros, posee osiconos y manchas con las que se camuflan, pueden alcanzar ramas altas en acacias de √Åfrica." , imagen: "images/jirafa.jpg"  },
      elefante:    { definicion: "El Mam√≠fero m√°s grande en la Tierra de g√©nero proboscidio y con caracter√≠sticas distintivas: grandes orejas, trompa prensil y el√°stica que usa para beber y respirar, dos grandes orejas y con rudimnetos de una inteligencia grande." , imagen: "images/elefante.jpg" },
      maradoniano: { definicion: "Gol especial que consiste en driblar a todo el equipo marcando gol as√≠." , imagen: "images/maradoniano.jpg" },
      negar:       { definicion: "Decir que no." },
      "negaci√≥n":{ definicion: "Acto y efecto de negar." }, 
      no:          { definicion: "Adverbio fundamental que es usado para negar todo tipo de frases." }, 
      hype:        { definicion: "Esperanza en el usuario de un bien de que ser√° revolucionario los avances de la t√©cnica." },
      poder:       { definicion: "Facultad libre de hacer algo." }, 
      todar:       { definicion: "Verbo de El todo que sirve para mover el universo ya sea material o ling√º√≠stico." },
      persona:{ definiciones: [ 
                                 "Individuo de la clase humana.", 
                                 "Individuo con nombre que se ignora o que se omite." , 
                                 "Categor√≠a gramatical que se manifiesta en pronombres y verbos y que distingue tres clases de individuos." ], imagen: "images/persona.png" },
      limitado:    { definicion: "Que tiene l√≠mites que ponen coto a su acci√≥n." }, 
      nadie:       { definicion: "1.Ning√∫n individuo." },
      eternamente:{ definiciones: [
                                 "1.De forma eterna.", 
                                 "2. Jam√°s." ] },
      eterno:      { definiciones: [ 
                                 "1.Que no posee inicio ni fin.", 
                                 "2.Que se reitera much√≠simo.", 
                                 "3.Se dice de Dios." ] },
      todopoderoso: { definicion: "Que es poderoso hasta todo." },
      omnipotente: { definicion: "Que lo puede todo, caracter√≠sticas reclamada por Dios." },
      aprender:    { definicion: "Adquirir el saber por medio del tratamiento de la informaci√≥n." },
      napolitano:{ definiciones: [ 
                                 "1.Natural de napoles.",
                                 "2.Perteneciente a napoles.",
                                 "3.Lengua de napoles.",
                                 "4.Higo de piel negra y sabor dulce.",
                                 "5.Conjunto de las primeras tres cartas en el juego de los tres sietes."  ] , imagen: "images/napolitano.png" },
      ultrabasico:{ definiciones: [
                                 "1.Rocas igneas con una composici√≥n de menos de 45% de silice.", 
                                 "2.Algo extremadamente fundamental.",
                                 "3.Slang en redes que es algo super simple." ] },
      ventes:      { definicion: "Combinaci√≥n de un adverbio en -mente con un adjetivo o participio: por ejemplo, algo extremadamente fundamentado." },
      artificial:{ definiciones: [
                                 "1.Fabricado por el hombre.",
                                 "2.Lo que es contrario a natural.",
                                 "3.Falso o simulado." ] , imagen: "images/artificial.png" },
      muerte:{ definiciones: [
                                 "1.Termino de la vida.",
                                 "2.Representacion de la muerte con una figura esquel√©tica y con guada√±a.", 
                                 "3.Persona insufrible.",
                                 "4.Ruina o destrucci√≥n de una idea." ], imagen: "images/muerte.png" },
      hollejo:{ definiciones: [ 
                                 "1.Piel o c√°scara de los frutos o legumbres.",
                                 "2.Piel humana o pellejo." ] },
      mapear:{ definiciones: [ 
                                 "1.Crear mapas de territorios con sus l√≠mites." , 
                                 "2.Investigar la parte en el todo, por ejemplo: los genes en los cromosomas.",
                                 "3.Hacer correspondencia de datos en entornos inform√°ticos." ] },
      patiestevado:{ definiciones: [ 
                                 "1.De piernas arqueadas." ,
                                 "2.De patas estevadas." ,
                                 "3.Con las piernas arqueadas conformando una especie de par√©ntesis." ,
                                 "4.Participio de patiestevar."  ], imagen: "images/patiestevado.png" },
      "sensaci√≥n":{ definiciones: [ 
                                 "1.El sentir en el cuerpo los est√≠mulos f√≠sicos decodificados por el cerebro.",
                                 "2.Percepci√≥n mas general que no necesariamente debe ser fisica sino que puede ser idea como el sentir de inutilidad.",
                                 "3.Gran impresi√≥n que ocasiona la noticia de un suceso.", 
                                 "4.Corazonada o presentimiento." ] },
      epica:    { definicion: "Epopeya narrada o cantada por un bardo que trata de los h√©roes del mundo antiguo." },
      epico:    { definicion: "Algo grandioso o fuera de norma." },
      eliminatoria:{ definiciones: [
                              "1.Clasificatoria.",
                              "2.Competicion anterior a los 4tos de final o los partidos anteriores al mundial en s√≠." ] },

  

  agujero: {
    definiciones: [
      "1.Abertura o hueco en una superficie o en un s√≥lido.",
      "2.De las agujas.",
      "3.Falta inmotivada de plata en una empresa."
    ]
  },

  negro: {
    definiciones: [
      "1.Ausencia total o casi de reflejo luminoso.",
      "2.De color negro.",
      "3.Perteneciente a la raza negra.",
      "4.Ritual en que se invoca al demonio.",
      "5.Del color de carb√≥n, de oscuridad total o la boca de un t√∫nel",
      "6.Muy bronceado.",
      "7.Modo de tratamiento de quienes se quieren.",
      "8.Persona que hace un trabajo intelectual por encargo de otra haciendo todo el esfuerzo.",
      "9.Estado de √°nimo triste o pesimista.",
      "10.G√©nero de cine que de trama policiaca en entorno violento."
    ]
  },

  de: {
    definiciones: [
      "1.Indica pertenencia. La paciencia de job.",
      "2.Locuciones adverbiales: Almorz√≥ de pie.",
      "3.Procedencia: Vengo de Aranjuez.",
      "4.Material: vestido de seda.",
      "5.Contenido: vaso de agua.",
      "6.Asunto: trata de la guerra.",
      "7.Causa: muri√≥ de viruelas.",
      "8.Naturaleza: hombre de valor.",
      "9.Desde: de Madrid a Toledo.",
      "10.Lejor de pensar.",
      "11.Hipot√©tico: de saberlo vendr√≠a.",
      "12.Per√≠frasis: acaba de pasar.",
      "13.Tiempo: de madrugada.",
      "14.Refuerzo: el bueno de Juan.",
      "15.Ilaci√≥n: de esto se sigue.",
      "16.Rapidez: beber de un trago.",
      "17.L√°stima: ay de los vencidos.",
      "18.A por la 16.",
      "19.Comparaci√≥n.",
      "20.Para. Gorro de dormir.",
      "21.Por miedo."
    ]
  },

  amanecer: {
    definiciones: [
      "1.Comenzar a verse la luz.",
      "2.Estar en un lugar al amanecer.",
      "3.Nacer figurado.",
      "4.Pasar la noche en vela.",
      "5.Alumbre."
    ]
  },

  manana: {
    definiciones: [
      "1.Parte del d√≠a entre amanecer y mediod√≠a.",
      "2.Medianoche a mediod√≠a.",
      "3.El tiempo futuro.",
      "4.El d√≠a siguiente."
    ]
  },

  en: {
    definiciones: [
      "1.Tiempo, lugar o modo.",
      "2.Sobre.",
      "3.Ocupaci√≥n.",
      "4.Tr√°nsito.",
      "5.Tan pronto como.",
      "6.L√≠mite de movimiento."
    ]
  },

  ese: {
    definiciones: [
      "1.Cercano al interlocutor.",
      "2.Mencionado.",
      "3.Menosprecio.",
      "4.Persona que se ha marchado."
    ]
  },

  campo: {
    definiciones: [
      "1.Terreno extenso.",
      "2.Terreno trabajable.",
      "3.Campi√±a.",
      "4.Terreno de juego.",
      "5.Mitad del campo en f√∫tbol.",
      "6.T√©rmino de municipio.",
      "7.Campo de conocimiento.",
      "8.Campo el√©ctrico.",
      "9.Campo de base de datos.",
      "10.Comarca ocupada por ej√©rcito.",
      "11.Ej√©rcito.",
      "12.Campo visual."
    ]
  },
 

  hipotetico: { definicion: "Perteneciente a la hip√≥tesis." },

  vencer: {
    definiciones: [
      "1.Batir al enemigo.",
      "2.Ser superior.",
      "3.Controlar emociones.",
      "4.Superar obst√°culos.",
      "5.Atraer a alguien al propio deseo.",
      "6.Subir a un sitio √°spero.",
      "7.Cumplirse plazo.",
      "8.Ganar en pelea f√≠sica."
    ]
  },

  supervitaminar: {
    definiciones: [
      "1.Potenciar algo.",
      "2.Hipertrofiar.",
      "3.Dopar con trampa."
    ]
  },

  "poder-verbo": {
    definiciones: [
      "1.Tener v√≠a libre para hacer a lo quiera.",
      "2.Expresa posibilidad.",
      "3.Ser capaz de vencer a otro.",
      "4.Sufrir impertinencias."
    ]
  },

  "poder-sustantivo": {
    definiciones: [
      "1.Facultad para hacer.",
      "2.Gobierno.",
      "3.Fuerza f√≠sica de animales.",
      "4.Permiso legal cedido."
    ]
  },

  infinito: {
    definiciones: [
      "1.Que no tiene fin.",
      "2.Ilimitado.",
      "3.Lo que carece de l√≠mite."
    ]
  },

  estado: { definiciones: ["1.Condici√≥n.", "2.Organizaci√≥n pol√≠tica."] },
  sentido: { definiciones: ["1.Significado.", "2.Funci√≥n fisiol√≥gica."] },
  fin: { definiciones: ["1.T√©rmino.", "2.Prop√≥sito."] },
  tener: { definiciones: ["1.Poseer.", "2.Sujetar.", "3.Ocurrir."] },
  traer: { definiciones: ["1.Llevar hacia aqu√≠.", "2.Causar."] },
  vejaciones: { definiciones: ["1.Maltrato.", "2.Humillaci√≥n persistente."] },

  
};


/* -------------------------------------
   √çNDICE NORMALIZADO
------------------------------------- */
const diccionarioIdx = {};
for (const [k, v] of Object.entries(diccionario)) {
  diccionarioIdx[normalizarPalabra(k)] = v;
}


/* -------------------------------------
   DETECCI√ìN PODER
------------------------------------- */
function tipoPoder(tokens, idx) {
  const palabra = normalizarPalabra(tokens[idx] || "");
  const prev = normalizarPalabra(tokens[idx - 1] || "");
  const next = normalizarPalabra(tokens[idx + 1] || "");

  const conjugaciones = [
    "puedo","puedes","puede","podemos","pueden",
    "podia","podias","podiamos","podian",
    "podra","podras","podremos","podran",
    "podria","podrias","podriamos","podrian",
    "pude","pudiste","pudo","pudimos","pudieron",
    "pueda","puedas","podamos","puedan",
    "pudiera","pudieras","pudieramos","pudieran",
    "pudiese","pudieses","pudiesemos","pudiesen"
  ];
  if (conjugaciones.includes(palabra)) return "verbo";

  const determinantes = [
    "el","la","los","las","un","una","unos","unas",
    "mi","mis","tu","tus","su","sus",
    "este","esta","estos","estas",
    "ese","esa","esos","esas",
    "aquel","aquella","aquellos","aquellas",
    "del","al"
  ];
  if (palabra === "poder" && determinantes.includes(prev)) return "sustantivo";

  if (palabra === "poder" && prev === "de") {
    if (next.endsWith("ar") || next.endsWith("er") || next.endsWith("ir"))
      return "verbo";
    return "sustantivo";
  }

  if (palabra === "poder" && (next.endsWith("ar") || next.endsWith("er") || next.endsWith("ir")))
    return "verbo";

  return null;
}


/* -------------------------------------
   LEMATIZACI√ìN
------------------------------------- */

const verbLemmaMap = {
  "puedo": "poder", "puedes": "poder", "puede": "poder",
  "podemos": "poder", "pueden": "poder",
  "podia": "poder", "podias": "poder", "podiamos": "poder", "podian": "poder",
  "podra": "poder", "podras": "poder", "podremos": "poder", "podran": "poder",
  "podria": "poder", "podrias": "poder", "podriamos": "poder", "podrian": "poder",
  "pude": "poder", "pudiste": "poder", "pudo": "poder", "pudimos": "poder", "pudieron": "poder",
  "pueda": "poder", "puedas": "poder", "podamos": "poder", "puedan": "poder",
  "pudiera": "poder", "pudieras": "poder", "pudieramos": "poder", "pudieran": "poder",
  "pudiese": "poder", "pudieses": "poder", "pudiesemos": "poder", "pudiesen": "poder",
  "creo": "crear"
};

const cliticEndings = [
  "melo","mela","melos","melas",
  "telo","tela","telos","telas",
  "selo","sela","selos","selas",
  "noslo","nosla","noslos","noslas",
  "oslo","osla","oslos","oslas",
  "me","te","se","lo","la","los","las","le","les","nos","os"
];

function stripClitics(word) {
  let w = word;
  let changed = true;
  while (changed) {
    changed = false;
    for (const cl of cliticEndings) {
      if (w.endsWith(cl) && w.length > cl.length + 1) {
        w = w.slice(0, -cl.length);
        changed = true;
        break;
      }
    }
  }
  return w;
}

function guessInfinitive(w) {
  if (verbLemmaMap[w]) return verbLemmaMap[w];

  if (w.endsWith("se")) {
    const base = w.slice(0, -2);
    if (diccionario[base]) return base;
  }

  if (w.endsWith("o")) {
    const stem = w.slice(0, -1);
    const candAr = stem + "ar";
    if (diccionario[candAr]) return candAr;
  }

  if (w.endsWith("aba") || w.endsWith("abas") || w.endsWith("aban")) {
    const stem = w.replace(/aba(s|n)?$/, "");
    const candAr = stem + "ar";
    if (diccionario[candAr]) return candAr;
  }

  if (w.endsWith("ando")) {
    const stem = w.slice(0, -4);
    const cand = stem + "ar";
    if (diccionario[cand]) return cand;
  }

  if (w.endsWith("iendo")) {
    const stem = w.slice(0, -5);
    const candEr = stem + "er";
    const candIr = stem + "ir";
    if (diccionario[candEr]) return candEr;
    if (diccionario[candIr]) return candIr;
  }

  if (w.endsWith("ar") || w.endsWith("er") || w.endsWith("ir"))
    return w;

  return w;
}

/* -------------------------------------
   TOKENIZACI√ìN Y CONSTRUCCI√ìN DEL LIBRO
------------------------------------- */

let tokensLibro = [];

function prepararLibro() {
  const fuente = document.getElementById("texto-libro").innerText;
  const contenedorLibro = document.getElementById("libro");

  const tokens = fuente.split(/(\s+)/);
  tokensLibro = [];

  contenedorLibro.innerHTML = "";
  let indiceToken = 0;

  tokens.forEach(token => {
    if (/^\s+$/.test(token)) {
      contenedorLibro.appendChild(document.createTextNode(token));
    } else {
      const span = document.createElement("span");
      span.textContent = token;
      span.className = "palabra";

      const idx = indiceToken;
      span.addEventListener("click", () => mostrarDefinicion(token, idx));

      tokensLibro.push(token);
      indiceToken++;

      contenedorLibro.appendChild(span);
    }
  });
}

/* -------------------------------------
   CONTEXTO
------------------------------------- */

function obtenerContexto(idx) {
  let inicio = idx;
  let fin = idx;

  while (inicio > 0) {
    const t = tokensLibro[inicio];
    if (/[.!?]/.test(t)) {
      inicio++;
      break;
    }
    inicio--;
  }

  while (fin < tokensLibro.length - 1) {
    const t = tokensLibro[fin];
    if (/[.!?]/.test(t)) break;
    fin++;
  }

  return tokensLibro.slice(inicio, fin + 1).join(" ");
}

/* -------------------------------------
   PALABRAS CLAVE
------------------------------------- */

function limpiarTexto(texto) {
  return texto
    .toLowerCase()
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "")
    .replace(/[^a-z0-9√±\s]/gi, " ");
}

const stopwords = new Set([
  "el","la","los","las","un","una","unos","unas",
  "lo","al","del",
  "de","a","en","por","para","con","sin","sobre",
  "y","o","u","ni",
  "que","se","su","sus","mi","mis","tu","tus",
  "este","esta","estos","estas","ese","esa","esos","esas",
  "aquel","aquella","aquellos","aquellas"
]);

function palabrasClave(texto) {
  return limpiarTexto(texto)
    .split(/\s+/)
    .filter(w => w.length > 2 && !stopwords.has(w));
}

/* -------------------------------------
   SIN√ìNIMOS
------------------------------------- */

const sinonimos = {
  vencer: ["ganar","derrotar","triunfar","vencer"],
  sufrir: ["aguantar","soportar","tolerar","padecer","sufrir"],
  impertinencias: ["vejaciones","abusos","humillaciones","maltratos"],
  posibilidad: ["posibilidad","quizas","talvez","acaso","hipotetico","probable","eventual"]
};

const pesosCategoria = {
  verbo: 2,
  sustantivo: 1,
  adjetivo: 0,
  adverbio: -1,
  pronombre: -2,
  determinante: -3,
  preposicion: -4,
  conjuncion: -5,
  interjeccion: -6
};

const categorias = {
  infinito: ["sustantivo","adjetivo"],
  poder: ["sustantivo","verbo"],
  amanecer: ["verbo"],
  manana: ["adverbio","sustantivo"],
  campo: ["sustantivo"],
  hipotetico: ["adjetivo"],
  vencer: ["verbo"],
  dios: ["sustantivo"],
  propio: ["adjetivo"],
  juego: ["sustantivo"],
  fin: ["sustantivo"],
  aguantar: ["verbo"],
  vejaciones: ["sustantivo"],
  traer: ["verbo"],
  tener: ["verbo"],
  estado: ["sustantivo"],
  sentido: ["sustantivo"]
};


/* -------------------------------------
   EXPANSI√ìN DE SIN√ìNIMOS
------------------------------------- */
function expandirConSinonimos(p) {
  const base = p.toLowerCase();
  const lista = [base];
  if (sinonimos[base]) lista.push(...sinonimos[base]);
  return lista;
}

/* -------------------------------------
   ELECCI√ìN DE DEFINICI√ìN
------------------------------------- */
function elegirDefinicionConExplicacion(definiciones, contexto) {
  const ctxWords = palabrasClave(contexto);
  const setCtx = new Set(ctxWords);

  let mejorIndice = 0;
  let mejorScore = -Infinity;
  let mejorExplicacion = { exactas: [], sinonimos: [], categorias: [], score: 0 };

  definiciones.forEach((def, idx) => {
    const palabrasDef = palabrasClave(def);
    let score = 0;
    let exactas = [];
    let sinos = [];
    let catsUsadas = [];

    palabrasDef.forEach(p => {
      const base = p.toLowerCase();
      let coincid = null;

      if (setCtx.has(base)) {
        coincid = base;
        score += 2;
        exactas.push(base);
      } else {
        const variantes = expandirConSinonimos(base);
        for (const v of variantes) {
          if (setCtx.has(v)) {
            coincid = v;
            score += 1;
            sinos.push({ palabraDef: base, coincidencia: v });
            break;
          }
        }
      }

      if (coincid) {
        const catList = categorias[coincid];
        if (catList) {
          for (const cat of catList) {
            if (pesosCategoria[cat] !== undefined) {
              const peso = pesosCategoria[cat];
              score += peso;
              catsUsadas.push({ palabra: coincid, categoria: cat, peso });
            }
          }
        }
      }
    });

    if (score > mejorScore) {
      mejorScore = score;
      mejorIndice = idx;
      mejorExplicacion = { exactas, sinonimos: sinos, categorias: catsUsadas, score };
    }
  });

  return { indice: mejorIndice, explicacion: mejorExplicacion };
}

/* -------------------------------------
   RESALTADO
------------------------------------- */

function limpiarResaltado() {
  document.querySelectorAll("#libro .palabra.resaltada")
    .forEach(e => e.classList.remove("resaltada"));
}

function resaltarCoincidencias(rawWord) {
  const objetivo = normalizarPalabra(rawWord);
  document.querySelectorAll("#libro .palabra").forEach(span => {
    const textoSpan = span.textContent || "";
    if (normalizarPalabra(textoSpan) === objetivo)
      span.classList.add("resaltada");
  });
}

/* -------------------------------------
   MUESTRA DE DEFINICI√ìN
------------------------------------- */

function obtenerClaveVerbal(rawWord, idx) {
  const original = rawWord.trim();

  if (original.toLowerCase().startsWith("dios")) return "dios";

  if (original === "cre√≥" || original === "Cre√≥")
    return diccionario["crear"] ? "crear" : original;

  let w = normalizarPalabra(original);
  w = stripClitics(w);
  const lemma = guessInfinitive(w);

  if (lemma === "poder") {
    const tipo = tipoPoder(tokensLibro, idx);
    if (tipo === "verbo") return "poder-verbo";
    if (tipo === "sustantivo") return "poder-sustantivo";
    return "poder-verbo";
  }

  return lemma;
}

  function mostrarDefinicion(rawWord, idx) {
  const clave = obtenerClaveVerbal(rawWord, idx);

  // Entrada en el diccionario (por clave directa o por √≠ndice normalizado)
  const entrada =
    diccionario[clave] ||
    diccionarioIdx[normalizarPalabra(clave)];

  const panel = document.getElementById("definicion");
  const debugBox = document.getElementById("debug-razonador");

  limpiarResaltado();
  resaltarCoincidencias(rawWord);

  if (!entrada) {
    panel.innerHTML = `
      <h2>${rawWord}</h2>
      <p class="sin-def">
        Esta palabra no tiene definici√≥n a√∫n.
        <br><small>(clave interna: ${clave})</small>
      </p>`;
    if (debugBox) {
      debugBox.textContent = "Palabra no encontrada en diccionario.";
    }
    return;
  }

  // Unificamos definiciones en un solo array
  let definiciones = [];
  if (entrada.definicion) definiciones.push(entrada.definicion);
  if (entrada.definiciones) definiciones.push(...entrada.definiciones);

  const contexto = obtenerContexto(idx);

  // ---------- INTENTO 1: RAZONADOR NUEVO ----------
  const resultadoRazonador = razonadorParaLema(clave, contexto);

  let indiceElegido = 0;
  let htmlExp = "";

  if (resultadoRazonador) {
    indiceElegido = resultadoRazonador.indiceAcepcion;

    if (debugBox) {
      debugBox.textContent = JSON.stringify(resultadoRazonador, null, 2);
    }

    htmlExp = `
      <hr>
      <p style="font-size:0.9em; color:green;">
        <strong>ü§ñ Elecci√≥n del razonador:</strong><br>
        Calidad: ${resultadoRazonador.calidad}<br>
        N√∫cleo detectado:
        <em>"${resultadoRazonador.palabraNucleo ? resultadoRazonador.palabraNucleo.palabra : "ninguno"}"</em>
      </p>`;
  } else {
    // ---------- INTENTO 2: L√ìGICA ANTIGUA ----------
    if (debugBox) {
      debugBox.textContent =
        "El razonador devolvi√≥ null (sin contexto suficiente). Usando l√≥gica simple.";
    }

    const { indice, explicacion } =
      elegirDefinicionConExplicacion(definiciones, contexto);
    indiceElegido = indice;

    const partes = [];
    if (explicacion.exactas.length) {
      partes.push("Coincidencias exactas: " + explicacion.exactas.join(", "));
    }
    if (explicacion.sinonimos.length) {
      partes.push(
        "Sin√≥nimos: " +
          explicacion.sinonimos
            .map((s) => s.coincidencia + "‚Üí" + s.definicion)
            .join(", ")
      );
    }

    if (partes.length) {
      htmlExp = `
        <hr>
        <p style="font-size:0.9em;">
          <strong>L√≥gica simple:</strong> ${partes.join(" | ")}</p>`;
    }
  }

  // Pintamos TODAS las acepciones, destacando la elegida
  const htmlDefs = definiciones
    .map(
      (d, i) =>
        `<p${
          i === indiceElegido
            ? ' style="color:blue; font-weight:bold; border-left:3px solid blue; padding-left:5px;"'
            : ""
        }>${d}</p>`
    )
    .join("");

  panel.innerHTML = `
    <h2>${rawWord}
      <small style="font-size:0.5em; color:grey;">(${clave})</small>
    </h2>
    ${htmlDefs}
    ${htmlExp}
  `;
  }

/* -------------------------------------
   INICIO
------------------------------------- */
/***************************************************
 *  RAZONADOR DEL DICCIONARIO
 *  - Rejilla de posici√≥n
 *  - Tabla de categor√≠as 9‚Äì1
 *  - Sistema de premios y castigos (22 reglas)
 *
 *  NOTA: no modifica nada de tu c√≥digo actual.
 ***************************************************/

/******** 1. Normalizaci√≥n y utilidades ********/

function norm(str) {
  return str
    .toLowerCase()
    .normalize("NFD")
    .replace(/[\u0300-\u036f]/g, "") // quita tildes
    .replace(/[.,;:!?¬°¬ø()"¬´¬ª]/g, "") // quita signos
    .trim();
}

function tokenizar(str) {
  const limpio = norm(str);
  return limpio.split(/\s+/).filter(Boolean);
}

// Palabras que ignoramos (ruido)
const STOPWORDS = new Set([
  "el","la","los","las","un","una","unos","unas",
  "de","del","a","en","y","o","u","que","lo","le","se",
  "por","para","con","sin","su","sus","mi","mis","tu","tus",
  "al"
]);

/******** 2. Tabla de categor√≠as (9‚Äì1) ********/

const CATEGORIA_PESOS = {
  verbo: 9,
  sustantivo: 8,
  adjetivo: 7,
  adverbio: 6,
  pronombre: 5,
  determinante: 4, // art√≠culos
  articulo: 4,
  preposicion: 3,
  conjuncion: 2,
  interjeccion: 1
};

// Listas simples para detectar clases funcionales
const DETERMINANTES = new Set([
  "el","la","los","las","un","una","unos","unas",
  "este","esta","estos","estas",
  "ese","esa","esos","esas",
  "aquel","aquella","aquellos","aquellas"
]);

const PREPOSICIONES = new Set([
  "a","ante","bajo","cabe","con","contra","de","desde","durante","en","entre",
  "hacia","hasta","mediante","para","por","segun","sin","so","sobre","tras","del","al"
]);

const CONJUNCIONES = new Set([
  "y","e","ni","o","u","pero","sino","aunque","que","porque","pues","mientras"
]);

const PRONOMBRES = new Set([
  "yo","tu","el","ella","nosotros","vosotros","ellos","ellas",
  "me","te","se","nos","os","lo","la","los","las","le","les"
]);

const INTERJECCIONES = new Set(["ay","oh","eh","uy","hala","bah","uff"]);

// Heur√≠stica de categor√≠a para cada palabra
function categoriaDePalabra(palabra, categoriaLema) {
  const w = norm(palabra);
  if (DETERMINANTES.has(w)) return "determinante";
  if (PREPOSICIONES.has(w)) return "preposicion";
  if (CONJUNCIONES.has(w)) return "conjuncion";
  if (PRONOMBRES.has(w)) return "pronombre";
  if (INTERJECCIONES.has(w)) return "interjeccion";
  if (w.endsWith("mente")) return "adverbio";
  if (w.endsWith("ar") || w.endsWith("er") || w.endsWith("ir")) return "verbo"; // infinitivo

  // si no sabemos, usamos la categor√≠a del lema como referencia
  if (!categoriaLema) return "sustantivo";
  return categoriaLema;
}

function pesoCategoria(palabra, categoriaLema) {
  const cat = categoriaDePalabra(palabra, categoriaLema);
  return CATEGORIA_PESOS[cat] || 0;
}

/******** 3. Peso por POSICI√ìN (rejilla m√≥vil) ********/
// i: posici√≥n (1..n), n: n¬∫ total de palabras
function pesoPosicion(i, n) {
  if (n <= 0) return 0;
  let max;
  if (n % 2 === 0) {
    // n par ‚Üí 4,3,2,1,0,-1,-2,-3...
    max = n / 2;
  } else {
    // n impar ‚Üí 3,2,1,0,-1,-2,-3...
    max = (n - 1) / 2;
  }
  return max - (i - 1);
}

/******** 4. Elecci√≥n de PALABRA N√öCLEO en UNA definici√≥n ********/

function elegirPalabraNucleo(definicion, categoriaLema) {
  const palabras = tokenizar(definicion);
  const n = palabras.length;
  if (n === 0) return null;

  let mejorIdx = 0;
  let mejorScore = -Infinity;

  for (let i = 0; i < n; i++) {
    const w = palabras[i];
    if (STOPWORDS.has(w)) continue; // ruido

    const posScore = pesoPosicion(i + 1, n);
    const catScore = pesoCategoria(w, categoriaLema);
    const score = posScore + catScore;

    if (score > mejorScore) {
      mejorScore = score;
      mejorIdx = i;
    }
  }

  return {
    palabra: palabras[mejorIdx],
    indice: mejorIdx,
    score: mejorScore
  };
}

/******** 5. Sistema de 22 reglas (premios/castigos) ********/
/*
   RESUMEN DE LAS REGLAS QUE SE APLICAN AQU√ç:

   CASTIGOS (score -= ...):
   1) Repetici√≥n del lema / calco del lema ............ -3
   2) Estructura "es que" ............................. -2
   3) Empezar o terminar con persona (me/te/se... la) . -1
   4) Repetir art√≠culos indefinidos (un/una/unos/unas) -1
   5) "que ..." sin sentido QUE (empieza por "que") .. -2
   6) Adverbio -mente sin verbo infinitivo ............ -1
   7) Empezar por participio (-ado/-ido/-to/-so/-cho).. -2
   8) Definici√≥n de palabra √∫nica ..................... -3
   9) Duda de "o" (muchos " o ") ...................... -1
   10) M√°s de 3 comas ................................. -1

   PREMIOS (score += ...):
   11) Presencia de "es" (ser copulativo) ............. +1
   12) Rondaci√≥n de "que": "de que", "al que", etc.... +2
   13) Terminar en participio o serie ................. +2
   14) "que" con buen uso (no "es que", ni al inicio) . +2
   15) N√∫cleo verbal en verbos (hay infinitivo) ....... +3
   16) "cuyo/cuya/cuyos/cuyas" ........................ +1
   17) Cadena nominal taxinomizada ("X de Y de Z") .... +2
   18) Calco del infinito ("no tiene ni puede tener") . +3
   19) Buena forma de adjetivo (adjetivo + "que" sin calco) +2
   20) Palabra ins√≥lita/t√©cnica (12+ letras) .......... +1
   21) Contenido antes de "que" (no empezar por "que") +2
   22) (Reserva para futuras variantes de las anteriores)
*/

function scoreCalidadDefinicion(definicion, lema, categoriaLema) {
  const textoNorm = " " + norm(definicion) + " ";
  const lemaNorm = norm(lema);
  const palabras = tokenizar(definicion);
  const n = palabras.length;
  let score = 0;

  // --- CASTIGOS ---

  // (1) Repetici√≥n del lema / calco del lema ‚Üí -3
  const raizLema = lemaNorm.slice(0, Math.max(3, Math.floor(lemaNorm.length / 2)));
  if (textoNorm.includes(" " + lemaNorm + " ") || textoNorm.includes(raizLema)) {
    score -= 3;
  }

  // (2) "es que" ‚Üí -2
  if (textoNorm.includes(" es que ")) score -= 2;

  // (3) Empezar o terminar con persona ‚Üí -1
  const defTrim = definicion.trim();
  const defNormTrim = textoNorm.trim();
  if (/^(me|te|se|nos|os)\s+\w+/i.test(defNormTrim) ||
      /\b(la|lo|las|los)\.?$/.test(defTrim)) {
    score -= 1;
  }

  // (4) Repetici√≥n de art√≠culos indefinidos ‚Üí -1
  const indefs = (textoNorm.match(/\b(un|uno|una|unos|unas)\b/g) || []).length;
  if (indefs >= 2) score -= 1;

  // (5) "que ..." sin sentido QUE ‚Üí empieza por "que " ‚Üí -2
  if (defNormTrim.startsWith("que ")) score -= 2;

  // (6) Adverbio desconectado de verbo ‚Üí -1
  const hayMente = palabras.some(w => norm(w).endsWith("mente"));
  const hayInfinitivo = palabras.some(w => {
    const wnorm = norm(w);
    return wnorm.endsWith("ar") || wnorm.endsWith("er") || wnorm.endsWith("ir");
  });
  if (hayMente && !hayInfinitivo) score -= 1;

  // (7) Empieza por participio ‚Üí -2
  const primeraNorm = norm(palabras[0] || "");
  if (/(ado|ido|to|so|cho)$/.test(primeraNorm)) score -= 2;

  // (8) Definici√≥n de palabra √∫nica ‚Üí -3
  if (n === 1) score -= 3;

  // (9) Duda de "o" (muchos " o ") ‚Üí -1
  const numO = (textoNorm.match(/\so\s/g) || []).length;
  if (numO >= 2) score -= 1;

  // (10) M√°s de 3 comas ‚Üí -1
  const numComas = (definicion.match(/,/g) || []).length;
  if (numComas > 3) score -= 1;

  // --- PREMIOS ---

  // (11) Presencia de " es " ‚Üí +1
  if (textoNorm.includes(" es ")) score += 1;

  // (12) Rondaci√≥n de "que" ‚Üí +2
  if (/(de que|al que|en que|lo que)/.test(textoNorm)) score += 2;

  // (13) Terminar en participio/serie ‚Üí +2
  const ultimaNorm = norm(palabras[palabras.length - 1] || "");
  if (/(ado|ido|to|so|cho)$/.test(ultimaNorm)) score += 2;

  // (14) Buen uso de "que" ‚Üí +2
  if (textoNorm.includes(" que ") && !defNormTrim.startsWith("que ") && !textoNorm.includes(" es que ")) {
    score += 2;
  }

  // (15) N√∫cleo verbal para lema verbo ‚Üí +3
  if (categoriaLema === "verbo" && hayInfinitivo) score += 3;

  // (16) cuyo/cuya/cuyos/cuyas ‚Üí +1
  if (/\bcuyo(s)?\b|\bcuya(s)?\b/.test(textoNorm)) score += 1;

  // (17) Cadena "X de Y de Z" (al menos dos " de ") ‚Üí +2
  const numDe = (textoNorm.match(/\sde\s/g) || []).length;
  if (numDe >= 2) score += 2;

  // (18) Calco del infinito ‚Üí +3
  if (textoNorm.includes("no tiene ni puede tener") ||
      textoNorm.includes("no tener ni poder tener") ||
      textoNorm.includes("es o puede ser") ||
      textoNorm.includes("son o pueden ser")) {
    score += 3;
  }

  // (19) Buena forma de adjetivo ‚Üí +2
  if (categoriaLema === "adjetivo" && textoNorm.includes(" que ") && !textoNorm.includes(raizLema)) {
    score += 2;
  }

  // (20) Palabra muy larga (t√©cnica) ‚Üí +1
  const hayLarga = palabras.some(w => norm(w).length >= 12);
  if (hayLarga) score += 1;

  // (21) Contenido antes de "que" ‚Üí +2
  if (textoNorm.includes(" que ") && !defNormTrim.startsWith("que ")) {
    score += 2;
  }

  // (22) De momento se solapa con 21; dejamos hueco para expansi√≥n futura.

  return score;
}

/******** 6. Elegir la mejor ACEPCI√ìN de un lema ********/

function elegirMejorAcepcion(lema, categoriaLema, definiciones, contextoTexto) {
  const contextoPalabras = tokenizar(contextoTexto).filter(w => !STOPWORDS.has(w));
  if (contextoPalabras.length === 0) return null;

  // 1. Buscamos acepciones candidatas (comparten palabra)
  const candidatas = [];
  definiciones.forEach((def, idx) => {
    const palabrasDef = tokenizar(def).filter(w => !STOPWORDS.has(w));
    const setDef = new Set(palabrasDef);
    const hayCoincidencia = contextoPalabras.some(w => setDef.has(w));
    if (hayCoincidencia) {
      candidatas.push({ index: idx, definicion: def });
    }
  });

  if (candidatas.length === 0) return null;
  if (candidatas.length === 1) return candidatas[0];

  // 2. Varias candidatas ‚Üí aplicamos calidad
  let mejor = null;
  let mejorScore = -Infinity;

  candidatas.forEach(c => {
    const calidad = scoreCalidadDefinicion(c.definicion, lema, categoriaLema);
    const numPalabras = tokenizar(c.definicion).length;

    if (calidad > mejorScore) {
      mejorScore = calidad;
      mejor = { ...c, calidad, numPalabras };
    } else if (calidad === mejorScore && mejor) {
      // Empate ‚Üí gana la m√°s larga
      if (numPalabras > mejor.numPalabras) {
        mejor = { ...c, calidad, numPalabras };
      }
    }
  });

  return mejor;
}

/******** 7. Funci√≥n de alto nivel para usar desde el libro ********/

function razonadorParaLema(lema, contextoTexto) {
  const entrada = diccionario[lema.toLowerCase()];
  if (!entrada) return null;

  // si en el diccionario a√±ades "categoria: 'verbo'" ser√° mejor;
  // si no, asumimos sustantivo por defecto
  const categoriaLema = entrada.categoria || "sustantivo";
  const defs = entrada.definiciones || [];

  const mejorAcep = elegirMejorAcepcion(lema, categoriaLema, defs, contextoTexto);
  if (!mejorAcep) return null;

  const nucleo = elegirPalabraNucleo(mejorAcep.definicion, categoriaLema);

  return {
    indiceAcepcion: mejorAcep.index,
    definicion: mejorAcep.definicion,
    calidad: mejorAcep.calidad,
    palabraNucleo: nucleo
  };
  }
prepararLibro();

</script> 
  <!-- DEBUG DEL RAZONADOR -->
<h3>Debug del razonador</h3>
<pre id="debug-razonador" style="border:1px solid #ccc; padding:0.5rem; white-space:pre-wrap;"></pre>

</body>
</html>
